{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/limitations-of-wp_query","result":{"data":{"markdownRemark":{"html":"<p>I ran into one of the limitations of WP_Query recently when I realized it couldn't do a <em>fairly simple</em> query.</p>\n<h2>Problem</h2>\n<p>I wanted to get all the clinical newsletter posts (post_type = \"clinical\"), PLUS any regular posts that were tagged \"clinical\". Nothing crazy, right? This requires either an \"OR\" clause, or a \"UNION\" of two separate queries. Can WP_Query do that? Of course not.</p>\n<h2>Solution</h2>\n<p>You just have to write your own query. No bigs. I was just surprised that Worpress wasn't smart enough to handle that for me. After all, isn't that why they wrote the WP_Query class?</p>\n<p>For what it's worth, here's what I did:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n<span class=\"token comment\">// Get clinical newsletters plus regular posts tagged \"clinical*\"</span>\n<span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token string single-quoted-string\">'\n    SELECT *\n    FROM wp_posts\n    WHERE post_type = \"clinical\"\n    AND post_status = \"publish\"\n\n    UNION\n\n    SELECT *\n    FROM wp_posts\n    WHERE post_type = \"post\"\n    AND post_status = \"publish\"\n    AND ID IN\n    (\n        SELECT object_id\n        FROM wp_term_relationships r\n        INNER JOIN wp_term_taxonomy x USING (term_taxonomy_id)\n        INNER JOIN wp_terms t USING (term_id)\n        WHERE t.slug LIKE \"clinical%\"\n    )\n\n    ORDER BY post_date DESC\n    LIMIT 5\n'</span><span class=\"token punctuation\">;</span>\n<span class=\"token variable\">$clinical_news</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$wpdb</span><span class=\"token operator\">-></span><span class=\"token function\">get_results</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Loop through each post</span>\n<span class=\"token keyword\">foreach</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$clinical_news</span> <span class=\"token keyword\">as</span> <span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">setup_postdata</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$post</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// do something with $post</span>\n<span class=\"token punctuation\">}</span></span></code></pre></div>","frontmatter":{"title":"Limitations of WP_Query","date":"June 29, 2013","tags":["php","wordpress"]},"fields":{"slug":"/blog/limitations-of-wp_query"}}},"pageContext":{"title":"Limitations of WP_Query","prev":{"frontmatter":{"title":"Import a database from the command line","tags":["command line","mysql"]},"excerpt":"Sometimes you need to import a large database that exceeds the size limits imposed by phpMyAdmin. You can change some settings in your php…","fields":{"slug":"/blog/import-a-database-from-the-command-line"}},"next":{"frontmatter":{"title":"MySQL SSH tunnel","tags":["command line","mysql","php"]},"excerpt":"If your MySQL server is configured to only accept local connections, then you can't connect remotely by just specifying the hostname in your…","fields":{"slug":"/blog/mysql-ssh-tunnel"}}}},"staticQueryHashes":["3649515864","63159454"]}