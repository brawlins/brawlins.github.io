{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/formatting-dates-in-gatsby","result":{"data":{"markdownRemark":{"html":"<h2>The problem</h2>\n<p>My blog post dates are stored in this format: \"YYYY-MM-DD\", but I wanted to display them in a different format. My first reaction was to run them through a formatting function in the React component. It turns out this was the hard way. The dates were coming back wrong due to timezone issues, and I ended up spending a lot of time trying to figure it out.</p>\n<h2>The solution</h2>\n<p>The easiest way to format a date in Gatsby is in the GraphQL query. Gatsby provides a <code class=\"language-text\">formatString</code> argument to GraphQL date fields that can be used to <a href=\"https://www.gatsbyjs.org/docs/graphql-reference/#dates\" target=\"_blank\">format the date at query time</a>. The resolver function uses <a href=\"https://momentjs.com/\" target=\"_blank\">Moment.js</a> to format dates, so you can pass any valid <a href=\"https://momentjs.com/docs/#/displaying/format/\" target=\"_blank\">Moment formatting tokens</a> in your string.</p>\n<p>Let's use today's date as an example. This <code class=\"language-text\">formatString</code> formats the date as \"June 4, 2020\":</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\">date<span class=\"token punctuation\">(</span><span class=\"token attr-name\">formatString</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"LL\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Timezone trouble</h2>\n<p>My formatting function used methods on the JavaScript <code class=\"language-text\">Date</code> and <code class=\"language-text\">Intl.DateTimeFormat</code> objects to format the date. When you create a <code class=\"language-text\">Date</code> object you introduce a time component as well. If the date string you started from has no time component, then the time defaults to midnight on that date (<code class=\"language-text\">00:00</code>). This is not a problem in and of itself, but what I forgot to account for is that a <code class=\"language-text\">Date</code> object represents a time value <em>in UTC time</em>. <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date\" target=\"_blank\">As stated in the docs</a>:</p>\n<blockquote>\n<p>A JavaScript date is fundamentally specified as the number of milliseconds that have elapsed since midnight on January 1, 1970, UTC.</p>\n</blockquote>\n<p>This can be demonstrated by typing this into your console:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2020-06-04\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Wed Jun 03 2020 18:00:00 GMT-0600 (Mountain Daylight Time)</span></code></pre></div>\n<p>This returns a date object with your local time offset, that represents <em>a UTC time</em> of midnight on the date given (<code class=\"language-text\">2020-06-04T00:00Z</code>). In my case, since I'm 6 hours behind UTC time, my dates were coming back as the day before the one I intended.</p>\n<p>That makes sense. But that still didn't explain why the date string was coming back wrong from the GraphQL query in the first place. What was Gatsby doing behind the scenes?</p>\n<h2>Going down the rabbit hole</h2>\n<p>Gatsby uses Moment.js under the hood, which assumes <em>local time</em> <a href=\"https://momentjs.com/docs/#/parsing/\" target=\"_blank\">per the docs</a>:</p>\n<blockquote>\n<p><code class=\"language-text\">moment(...)</code> is local mode. Ambiguous input (without offset) is assumed to be local time. Unambiguous input (with offset) is adjusted to local time.</p>\n</blockquote>\n<p>Again, you can verify this if you create a code sandbox with the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2020-06-04\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 2020-06-04T00:00:00-06:00</span></code></pre></div>\n<p>However, when I ran my GraphQL query <em>without</em> the <code class=\"language-text\">formatString</code>, the <code class=\"language-text\">date</code> field came back in UTC time like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2020-06-04T00:00:00.000Z</code></pre></div>\n<p>If you create a new <code class=\"language-text\">Date</code> object from that date string, you run into the timezone issues we just talked about.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2020-06-04T00:00:00.000Z\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Wed Jun 03 2020 18:00:00 GMT-0600 (Mountain Daylight Time)</span></code></pre></div>\n<p>I had to go to the source code and find the resolver function for the date field to figure out what was happening. Apparently, Gatsby converts dates to UTC time using <code class=\"language-text\">moment.utc()</code>. This puts you into <a href=\"https://momentjs.com/docs/#/parsing/utc/\" target=\"_blank\">UTC mode</a>, which assumes UTC time instead of local time.</p>\n<p>Contrast these two examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Moment</span>\n<span class=\"token keyword\">let</span> local <span class=\"token operator\">=</span> <span class=\"token function\">moment</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2020-06-04\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> utc <span class=\"token operator\">=</span> moment<span class=\"token punctuation\">.</span><span class=\"token function\">utc</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2020-06-04\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Date string</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>utc<span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Timestamp</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>utc<span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Which return these date strings and timestamps:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2020-06-04T00:00:00-06:00\n2020-06-04T00:00:00Z\n1591250400000\n1591228800000</code></pre></div>\n<p>As you can see from the timestamps, they now represent two different moments in time. The first is midnight at local time. The second is midnight at UTC time. This is the problem I was hitting against. If you don't format your date field in the query using the <code class=\"language-text\">formatString</code>, you get back a date string that represents midnight UTC time on the date given. Then when you try to create a <code class=\"language-text\">Date</code> object from that date string, you have timezone issues.</p>\n<h2>Lessons learned</h2>\n<p>First of all, read the documentation. If I had known that the <code class=\"language-text\">formatString</code> argument was available to me, I wouldn't have written my own formatting function and gone down this bumpy road. On the other hand, nothing is lost. This little jaunt into the weeds was a good reminder about how dates work and the issues we have to consider when dealing with timezones. Hopefully this will spare somebody else some heartburn :).</p>","frontmatter":{"title":"Formatting dates in Gatsby","date":"June 4, 2020","tags":["gatsby","javascript"]},"fields":{"slug":"/blog/formatting-dates-in-gatsby"}}},"pageContext":{"title":"Formatting dates in Gatsby","prev":{"frontmatter":{"title":"Taking back my data","tags":["privacy"]},"excerpt":"Recently I finished a big project that took a few months to complete. I decided to migrate all of my family's data away from Google products…","fields":{"slug":"/blog/taking-back-my-data"}},"next":{"frontmatter":{"title":"Trying out Gatsby","tags":["gatsby"]},"excerpt":"Lately I've been feeling like I should start blogging again, but the site needed some love first. As they say, \"The cobbler's children have…","fields":{"slug":"/blog/trying-out-gatsby"}}}},"staticQueryHashes":["3649515864","63159454"]}