<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.fd24ea68bffbf39b995a.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap);@import url(https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap);
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}html{font-size:16px;line-height:1.6}body{background-color:#fff;color:#333;font-family:Merriweather,serif}h1,h2,h3,h4,h5,h6{font-family:Roboto,Arial,Helvetica,sans-serif;line-height:1.3;margin-top:.4em;margin-bottom:.6em}p,pre,pre[class*=language-]{margin-bottom:1.5em}a,a:active,a:hover,a:link,a:visited{color:#3891a6}a:active,a:hover{color:#046e8f;text-decoration:underline}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{text-decoration:none}</style><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true">The right way to do an ajax post in Wordpress | brettrawlins.com</title><meta data-react-helmet="true" name="description" content="Personal blog site of Brett Rawlins."/><meta data-react-helmet="true" property="og:title" content="The right way to do an ajax post in Wordpress"/><meta data-react-helmet="true" property="og:description" content="Personal blog site of Brett Rawlins."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Brett Rawlins"/><meta data-react-helmet="true" name="twitter:title" content="The right way to do an ajax post in Wordpress"/><meta data-react-helmet="true" name="twitter:description" content="Personal blog site of Brett Rawlins."/><link as="font" href="https://fonts.gstatic.com/s/merriweather/v25/u-4m0qyriQwlOrhSvowK_l5-eRZOf-LVrPHp.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/merriweather/v25/u-440qyriQwlOrhSvowK_l5-fCZMdeX3rg.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/merriweather/v25/u-4n0qyriQwlOrhSvowK_l52xwNZWMf6hPvhPQ.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/roboto/v27/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2" rel="preload" crossorigin="anonymous"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-P5V233Q1J4"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-P5V233Q1J4', {"anonymize_ip":false,"send_page_view":false});
      }
      </script><link rel="icon" href="/favicon-32x32.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#075E7E"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link as="script" rel="preload" href="/webpack-runtime-84dd26790791d59e0189.js"/><link as="script" rel="preload" href="/framework-6271aad6e301858fde44.js"/><link as="script" rel="preload" href="/styles-806f4b82980a743e7980.js"/><link as="script" rel="preload" href="/app-5eb3d74c66cffa4d5744.js"/><link as="script" rel="preload" href="/commons-a484f0fa5c3e150fe32e.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f7e80faf665a18051650.js"/><link as="fetch" rel="preload" href="/page-data/blog/the-right-way-to-do-an-ajax-post-in-wordpress/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="t8r5rj">.css-t8r5rj{margin-bottom:2em;}.css-t8r5rj > div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:0 auto;max-width:960px;padding:1em;}.css-t8r5rj h1{font-size:22px;font-weight:normal;margin:0;}.css-t8r5rj h1 a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-t8r5rj h1 img{height:44px;width:44px;margin-right:10px;}.css-t8r5rj nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><header class="css-t8r5rj"><div><h1><a style="color:#333;text-decoration:none" href="/"><img src="/static/icon-d8d1951ab6f893131507584b4d5eb926.png" alt="logo"/><span>Brett Rawlins</span></a></h1><nav><a style="color:#333;text-decoration:none" href="/about">About</a></nav></div></header><div style="margin:0 auto;max-width:960px;padding:0 1.0875rem 1.45rem"><main><div><h1>The right way to do an ajax post in Wordpress</h1><style data-emotion-css="yvms1f">.css-yvms1f{color:#aaa;}</style><p class="css-yvms1f">November 16, 2013</p><div class="blogPost"><p>For a long time making ajax calls in Wordpress was very confusing to me. After reading the <a href="http://codex.wordpress.org/AJAX_in_Plugins" target="_blank">Codex</a> and several articles about it, I think I understand it a little better now. When you stop fighting Wordpress and do it the "Wordpress way" it's not too bad. Here's a little plugin that demonstrates how to do an ajax post from the front end the right way.</p>
<p>My plugin has two files. The folder looks like this:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token builtin class-name">.</span>
└── My_Ajax
    ├── My_Ajax.php
    └── js
        └── my-ajax-request.js</code></pre></div>
<h2>First the code:</h2>
<p><strong>My_Ajax.php</strong></p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token comment">/**
 * Plugin Name: My Ajax
 * Description: Testing ajax calls in Wordpress
 * Author: Brett Rawlins
 */</span>

<span class="token comment">// instantiate it</span>
<span class="token variable">$My_Ajax</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">My_Ajax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">My_Ajax</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// get scripts ready</span>
        <span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'init'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'prepare_scripts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// connect your ajax handler to the custom action hook for your action</span>
        <span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'wp_ajax_my_frontend_action'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'frontend_ajax_handler'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'wp_ajax_nopriv_my_frontend_action'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'frontend_ajax_handler'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">prepare_scripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// enqueue script</span>
        <span class="token function">wp_enqueue_script</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'my-ajax-request'</span><span class="token punctuation">,</span> <span class="token function">plugins_url</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'js/my-ajax-request.js'</span><span class="token punctuation">,</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// localize it (define ajax object for your variables)</span>
        <span class="token function">wp_localize_script</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'my-ajax-request'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'MyAjaxObject'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string single-quoted-string">'ajax_url'</span> <span class="token operator">=></span> <span class="token function">admin_url</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin-ajax.php'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string single-quoted-string">'nonce'</span> <span class="token operator">=></span> <span class="token function">wp_create_nonce</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'my-frontend-action-nonce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">frontend_ajax_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">global</span> <span class="token variable">$wpdb</span><span class="token punctuation">;</span>
        <span class="token comment">// now you can access the database</span>

        <span class="token comment">// make sure the request is legit</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">wp_verify_nonce</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-frontend-action-nonce'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">exit</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// print out the POST array</span>
        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">exit</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong>my-ajax-request.js</strong></p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// my-ajax-request.js</span>
<span class="token function">jQuery</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.my-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// get form data</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.my-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// add my action (for ajax routing)</span>
        data <span class="token operator">+=</span> <span class="token string">'&amp;action='</span> <span class="token operator">+</span> <span class="token string">'my_frontend_action'</span><span class="token punctuation">;</span>
        <span class="token comment">// add nonce (for verification)</span>
        data <span class="token operator">+=</span> <span class="token string">'&amp;nonce='</span> <span class="token operator">+</span> MyAjaxObject<span class="token punctuation">.</span>nonce<span class="token punctuation">;</span>
        <span class="token comment">// post it</span>
        $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>MyAjaxObject<span class="token punctuation">.</span>ajax_url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>Now let's walk through it.</h2>
<p>Wordpress has a built-in ajax handler located at <code class="language-text">/wp-admin/admin-ajax.php</code>. This is set up so that you can post to that file and pass a custom "action" variable in your <code class="language-text">$_POST</code> array. The important part of that file looks like this:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">is_user_logged_in</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token function">do_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp_ajax_'</span> <span class="token operator">.</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Authenticated actions</span>
<span class="token keyword">else</span>
    <span class="token function">do_action</span><span class="token punctuation">(</span> <span class="token string single-quoted-string">'wp_ajax_nopriv_'</span> <span class="token operator">.</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Non-admin actions</span></code></pre></div>
<p>This code makes two custom action hooks available to you: one for logged-in users and one for regular users. The action hooks are named after the action you provided. So if my action is "do_cool_stuff", then the corresponding action hooks are called "wp_ajax_do_cool_stuff" and "wp_ajax_nopriv_do_cool_stuff".</p>
<p>The <code class="language-text">do_action()</code> call here invokes all functions attached to that action hook. So now all we have to do is write a function (which will be our own custom ajax handler for this call), and then attach it to this action hook. We do that like so:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token comment">// connect your ajax handler to the custom action hook for your action</span>
<span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'wp_ajax_my_frontend_action'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'frontend_ajax_handler'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'wp_ajax_nopriv_my_frontend_action'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'frontend_ajax_handler'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>My ajax handler function doesn't actually do much. It simply verifies the nonce to make sure the request is coming from the right place, and then prints out the the posted variables:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">frontend_ajax_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">global</span> <span class="token variable">$wpdb</span><span class="token punctuation">;</span>
    <span class="token comment">// now you can access the database</span>

    <span class="token comment">// make sure the request is legit</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">wp_verify_nonce</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nonce'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'my-frontend-action-nonce'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">exit</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// print out the POST array</span>
    <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>You could do whatever you want here. One important thing to note is that you have to call <code class="language-text">exit()</code> or <code class="language-text">die()</code> here after you echo whatever you want to return to the calling javascript function. Otherwise <code class="language-text">admin-ajax.php</code> will echo a 0 or 1 which gets added to the end of your response text, and that could possibly break stuff on the other end.</p>
<p>Since we put our javascript in a separate file, we want to enqueue that script so that it loads on the page where we need to call it. We can also define a global ajax object that we can use to pass variables around with. This is a little cleaner than having to echo out variables wrapped in php tags into our javascript.</p>
<p>First we write a function to prepare our scripts:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">prepare_scripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// enqueue script</span>
    <span class="token function">wp_enqueue_script</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'my-ajax-request'</span><span class="token punctuation">,</span> <span class="token function">plugins_url</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'js/my-ajax-request.js'</span><span class="token punctuation">,</span> <span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// localize it (define ajax object for your variables)</span>
    <span class="token function">wp_localize_script</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'my-ajax-request'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'MyAjaxObject'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'ajax_url'</span> <span class="token operator">=></span> <span class="token function">admin_url</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'admin-ajax.php'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string single-quoted-string">'nonce'</span> <span class="token operator">=></span> <span class="token function">wp_create_nonce</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'my-frontend-action-nonce'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Then we attach that function to some action hook that will fire before the page loads:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token comment">// get scripts ready</span>
<span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'init'</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'prepare_scripts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Now all that's left is the javascript which actually makes the ajax call. Here I'm simply grabbing a form and posting its data to my ajax handler. First I serialize the form fields, then I add my action and nonce variables to it, and then I post it. When the response comes back from the handler (which is just the post variables), I log it to the console so we can see that it came back correctly. Then I return false to prevent the page from reloading (the form has no action attribute so by default it will submit to the page it's on which would reload the page).</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token function">jQuery</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.my-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// get form data</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.my-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// add my action (for ajax routing)</span>
        data <span class="token operator">+=</span> <span class="token string">'&amp;action='</span> <span class="token operator">+</span> <span class="token string">'my_frontend_action'</span><span class="token punctuation">;</span>
        <span class="token comment">// add nonce (for verification)</span>
        data <span class="token operator">+=</span> <span class="token string">'&amp;nonce='</span> <span class="token operator">+</span> MyAjaxObject<span class="token punctuation">.</span>nonce<span class="token punctuation">;</span>
        <span class="token comment">// post it</span>
        $<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>MyAjaxObject<span class="token punctuation">.</span>ajax_url<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>That's it! Hopefully that helps clarify the process a little. Here's some other good reading on the subject of using ajax in Wordpress:</p>
<ul>
<li><a href="http://www.garyc40.com/2010/03/5-tips-for-using-ajax-in-wordpress/" target="_blank">5 tips for using AJAX in WordPress</a></li>
<li><a href="http://wp.smashingmagazine.com/2011/10/18/how-to-use-ajax-in-wordpress/" target="_blank">How To Use AJAX In WordPress</a></li>
</ul></div><style data-emotion-css="1feh9oy">.css-1feh9oy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:2em;margin-bottom:2em;}.css-1feh9oy span{font-weight:bold;margin-right:5px;}.css-1feh9oy a{margin-right:10px;}</style><div class="css-1feh9oy"><span>Tags:</span><a href="/tags/ajax">#<!-- -->ajax</a><a href="/tags/wordpress">#<!-- -->wordpress</a></div><style data-emotion-css="1gwgz2q">.css-1gwgz2q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-bottom:1em;}.css-1gwgz2q a + a{margin-left:10px;}</style><div class="css-1gwgz2q"><a href="/blog/removing-unused-tags-in-wordpress">« <!-- -->Removing unused tags in Wordpress</a><a href="/blog/fixing--is-not-a-function-in-wordpress">Fixing &quot;$ is not a function&quot; in Wordpress<!-- --> »</a></div></div></main><style data-emotion-css="46b038">.css-46b038{margin-top:30px;}</style><footer class="css-46b038">© <!-- -->2023<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/the-right-way-to-do-an-ajax-post-in-wordpress";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1ea82b852c7088465fbe.js"],"app":["/app-5eb3d74c66cffa4d5744.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a1a1d500f025aea3be51.js"],"component---src-pages-about-js":["/component---src-pages-about-js-035f908c53a26869440c.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b2f1b0a1f5940ce48f34.js"],"component---src-templates-all-tags-index-js":["/component---src-templates-all-tags-index-js-cc7f003fd5d5e8cb5b61.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f7e80faf665a18051650.js"],"component---src-templates-single-tag-index-js":["/component---src-templates-single-tag-index-js-ce5b8974d24bb230b945.js"]};/*]]>*/</script><script src="/polyfill-1ea82b852c7088465fbe.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-f7e80faf665a18051650.js" async=""></script><script src="/commons-a484f0fa5c3e150fe32e.js" async=""></script><script src="/app-5eb3d74c66cffa4d5744.js" async=""></script><script src="/styles-806f4b82980a743e7980.js" async=""></script><script src="/framework-6271aad6e301858fde44.js" async=""></script><script src="/webpack-runtime-84dd26790791d59e0189.js" async=""></script></body></html>