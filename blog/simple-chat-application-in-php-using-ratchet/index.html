<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.fd24ea68bffbf39b995a.css" id="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap);@import url(https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap);
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}html{font-size:16px;line-height:1.6}body{background-color:#fff;color:#333;font-family:Merriweather,serif}h1,h2,h3,h4,h5,h6{font-family:Roboto,Arial,Helvetica,sans-serif;line-height:1.3;margin-top:.4em;margin-bottom:.6em}p,pre,pre[class*=language-]{margin-bottom:1.5em}a,a:active,a:hover,a:link,a:visited{color:#3891a6}a:active,a:hover{color:#046e8f;text-decoration:underline}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{text-decoration:none}</style><meta name="generator" content="Gatsby 2.32.13"/><title data-react-helmet="true">Simple chat application in PHP using Ratchet | brettrawlins.com</title><meta data-react-helmet="true" name="description" content="Personal blog site of Brett Rawlins."/><meta data-react-helmet="true" property="og:title" content="Simple chat application in PHP using Ratchet"/><meta data-react-helmet="true" property="og:description" content="Personal blog site of Brett Rawlins."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Brett Rawlins"/><meta data-react-helmet="true" name="twitter:title" content="Simple chat application in PHP using Ratchet"/><meta data-react-helmet="true" name="twitter:description" content="Personal blog site of Brett Rawlins."/><link as="font" href="https://fonts.gstatic.com/s/merriweather/v25/u-4m0qyriQwlOrhSvowK_l5-eRZOf-LVrPHp.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/merriweather/v25/u-440qyriQwlOrhSvowK_l5-fCZMdeX3rg.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/merriweather/v25/u-4n0qyriQwlOrhSvowK_l52xwNZWMf6hPvhPQ.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2" rel="preload" crossorigin="anonymous"/><link as="font" href="https://fonts.gstatic.com/s/roboto/v27/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2" rel="preload" crossorigin="anonymous"/><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-P5V233Q1J4"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-P5V233Q1J4', {"anonymize_ip":false,"send_page_view":false});
      }
      </script><link rel="icon" href="/favicon-32x32.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#075E7E"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=ea93a63e96a55d6d23a287ebb32daef2"/><link as="script" rel="preload" href="/webpack-runtime-fda9dc8a864f6339dfc4.js"/><link as="script" rel="preload" href="/framework-6271aad6e301858fde44.js"/><link as="script" rel="preload" href="/styles-806f4b82980a743e7980.js"/><link as="script" rel="preload" href="/app-5eb3d74c66cffa4d5744.js"/><link as="script" rel="preload" href="/commons-a484f0fa5c3e150fe32e.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f7e80faf665a18051650.js"/><link as="fetch" rel="preload" href="/page-data/blog/simple-chat-application-in-php-using-ratchet/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion-css="t8r5rj">.css-t8r5rj{margin-bottom:2em;}.css-t8r5rj > div{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:0 auto;max-width:960px;padding:1em;}.css-t8r5rj h1{font-size:22px;font-weight:normal;margin:0;}.css-t8r5rj h1 a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.css-t8r5rj h1 img{height:44px;width:44px;margin-right:10px;}.css-t8r5rj nav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><header class="css-t8r5rj"><div><h1><a style="color:#333;text-decoration:none" href="/"><img src="/static/icon-d8d1951ab6f893131507584b4d5eb926.png" alt="logo"/><span>Brett Rawlins</span></a></h1><nav><a style="color:#333;text-decoration:none" href="/about">About</a></nav></div></header><div style="margin:0 auto;max-width:960px;padding:0 1.0875rem 1.45rem"><main><div><h1>Simple chat application in PHP using Ratchet</h1><style data-emotion-css="yvms1f">.css-yvms1f{color:#aaa;}</style><p class="css-yvms1f">August 18, 2015</p><div class="blogPost"><p>In the previous post I made a <a href="/blog/simple-chat-application-using-react-and-socket-io">demo chat app using React and Socket.io</a>. In this post we'll build that same app again, this time in PHP using Ratchet.</p>
<p>There's a nice PHP library called <a href="http://socketo.me/" target="_blank">Ratchet</a> that simplifies working with web sockets. In this example I use <a href="https://getcomposer.org/" target="_blank">Composer</a> to manage the PHP library dependencies and handle autoloading.</p>
<h2>Project Setup</h2>
<p>The project directory structure looks like this:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">├── bin
├── public
├── src
└── vendor</code></pre></div>
<ul>
<li><strong>bin</strong>:  Holds the web socket server file. This will run in the background listening for connections and handling events.</li>
<li><strong>public</strong>:  All of our client code goes here. This is the web document root.</li>
<li><strong>src</strong>:  Holds our custom server side code</li>
<li><strong>vendor</strong>:  For third-party PHP libraries managed by Composer.</li>
</ul>
<h2>The Server</h2>
<h3>bin/server.php</h3>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// import namespaces</span>
<span class="token keyword">use</span> <span class="token package">Ratchet<span class="token punctuation">\</span>Server<span class="token punctuation">\</span>IoServer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Ratchet<span class="token punctuation">\</span>WebSocket<span class="token punctuation">\</span>WsServer</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">MyChat<span class="token punctuation">\</span>Chat</span><span class="token punctuation">;</span>

<span class="token comment">// use the autoloader provided by Composer</span>
<span class="token keyword">require</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__DIR__</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span>

<span class="token comment">// create a websocket server</span>
<span class="token variable">$server</span> <span class="token operator">=</span> <span class="token class-name static-context">IoServer</span><span class="token operator">::</span><span class="token function">factory</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">WsServer</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Chat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token number">8080</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$server</span><span class="token operator">-></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></div>
<p>Here we load the namespaces for the Ratchet libraries and our own Chat class that will handle the chat messages. Composer creates an autoloader for us that we can use to load the class names, so we require that. Then we create a web socket server, give it our Chat handler class, and tell it to listen on port 8080. Ratchet provides several components that you can choose from. Here we're using the WsServer (WebSocket server) component.</p>
<h3>src/MyChat/Chat.php</h3>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">MyChat</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Ratchet<span class="token punctuation">\</span>MessageComponentInterface</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Ratchet<span class="token punctuation">\</span>ConnectionInterface</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Chat</span> <span class="token keyword">implements</span> <span class="token class-name">MessageComponentInterface</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token variable">$clients</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// initialize clients storage</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">clients</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>SplObjectStorage</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">onOpen</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ConnectionInterface</span> <span class="token variable">$conn</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// store new connection in clients</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">clients</span><span class="token operator">-></span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"New connection: %s\n"</span><span class="token punctuation">,</span> <span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">resourceId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// send a welcome message to the client that just connected</span>
        <span class="token variable">$conn</span><span class="token operator">-></span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'type'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'message'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'text'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'Welcome to the test chat app!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">onClose</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ConnectionInterface</span> <span class="token variable">$conn</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// remove connection from clients</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">clients</span><span class="token operator">-></span><span class="token function">detach</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Connection closed: %s\n"</span><span class="token punctuation">,</span> <span class="token variable">$conn</span><span class="token operator">-></span><span class="token property">resourceId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ConnectionInterface</span> <span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token class-name type-declaration">Exception</span> <span class="token variable">$error</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// display error message and close connection</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error: %s\n"</span><span class="token punctuation">,</span> <span class="token variable">$error</span><span class="token operator">-></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$conn</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">onMessage</span><span class="token punctuation">(</span><span class="token class-name type-declaration">ConnectionInterface</span> <span class="token variable">$conn</span><span class="token punctuation">,</span> <span class="token variable">$message</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// send message out to all connected clients</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">clients</span> <span class="token keyword">as</span> <span class="token variable">$client</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$client</span><span class="token operator">-></span><span class="token function">send</span><span class="token punctuation">(</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></span></code></pre></div>
<p>Note that our Chat class implements the "MessageComponentInterface" provided by the Ratchet WsServer component. That interface exposes 4 events that our server can listen for, so we register a callback function for each one. See the <a href="http://socketo.me/docs/websocket" target="_blank">WsServer documentation</a> for more details.</p>
<p>When we start up our socket server a new instance of our Chat class is created. The constructor simply creates an object to store client connections in.</p>
<p>The <code class="language-text">onOpen</code> event fires when a new client connects to the socket server. This function stores the new connection and sends the client a welcome message. We're also printing out the connection ID to the shell where the server is running.</p>
<p>The <code class="language-text">onClose</code> event fires when a client connection is closed (user closes the browser window). We remove that client from our storage and print out another message to the server shell.</p>
<p>The <code class="language-text">onError</code> event fires when we encounter a connection error. We print out the error message to the terminal and close the connection.</p>
<p>The <code class="language-text">onMessage</code> event is where the magic happens. This event fires when the socket server receives a message from one of the connected clients. We loop through all the connected clients and send that message out to each one. This keeps the clients in sync, so that when one user posts a message it gets broadcast out to all the other connected clients.</p>
<h2>The Client</h2>
<h3>public/index.html</h3>
<div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Ratchet Test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bower_components/jquery/dist/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Chat App Using Ratchet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>Messages<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>message-form<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Type your message here<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">></span></span>Post it!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre></div>
<p>This is pretty straight forward. We have an unordered list that will get populated with the chat messages, and a form for posting new messages.</p>
<p>In the header we're loading two scripts. This example uses jQuery, so you need that. I've loaded it using Bower, but you can link to it however you want. The other script (app.js) is our client-side application code that we'll get to next.</p>
<h3>public/app.js</h3>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token comment">// initialize messages array</span>
<span class="token keyword">var</span> messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// connect to the socket server</span>
<span class="token keyword">var</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
conn<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connected to server:'</span><span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

conn<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error: Could not connect to server.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

conn<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Connection closed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// handle new message received from the socket server</span>
conn<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// message is data property of event object</span>
    <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// add to message list</span>
    <span class="token keyword">var</span> li <span class="token operator">=</span> <span class="token string">'&lt;li>'</span> <span class="token operator">+</span> message<span class="token punctuation">.</span>text <span class="token operator">+</span> <span class="token string">'&lt;/li>'</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.message-list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// attach onSubmit handler to the form</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.message-form'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// prevent form submission which causes page reload</span>
        e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get the input</span>
        <span class="token keyword">var</span> input <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// get message text from the input</span>
        <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token punctuation">{</span>
            type<span class="token operator">:</span> <span class="token string">'message'</span><span class="token punctuation">,</span>
            text<span class="token operator">:</span> input<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// clear the input</span>
        input<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// send message to server</span>
        conn<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>This code runs in the client browser and allows it to connect to the socket server and send and receive messages. <a href="http://www.w3.org/TR/websockets/#the-websocket-interface" target="_blank">The W3C WebSocket API</a> exposes the same 4 events that we saw in our server code, and we define a callback function to handle each one. <strong>Note that these event names are all lower-case though.</strong></p>
<p>The <code class="language-text">onopen</code> event fires when our client connects to the socket server. We log a message to the browser's console.</p>
<p>The <code class="language-text">onerror</code> event fires when we have a connection error.</p>
<p>The <code class="language-text">onclose</code> event fires when our client closes its connection to the socket server.</p>
<p>The <code class="language-text">onmessage</code> event fires when the client receives a message from the socket server. Each of these callbacks receives an event object as an argument (I assigned to the variable "e"). The actual payload of the message is contained in the event object's "data" property. Here we grab the message, log it to the console, and then append it to the unordered list using jQuery.</p>
<p>The last piece of code uses jQuery to add an event handler to the message form. When we submit that form, we want the client to send the message we typed to the socket server. Here we grab the value of the text input, create a message object, clear the input, and then send the message to the server. This action will fire an "onMessage" event on the server, which will respond by sending that message out to all the connected clients as we saw in the server code earlier.</p>
<h2>Running the app</h2>
<p><a href="">Download the files here</a>.</p>
<p>To run the app you'll need to install the PHP libraries on your server. Composer will handle that for you. Open a shell terminal on your server, navigate to the project directory and type:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell"><span class="token function">composer</span> <span class="token function">install</span></code></pre></div>
<p>If you're using the Bower file for the client libraries, type:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">bower <span class="token function">install</span></code></pre></div>
<p>Then start up the web socket server we created which will listen for message events:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">php bin/server.php</code></pre></div>
<p>That will run the socket server code which will start listening for connections and events on port 8080. Then open up two browser windows and point them to wherever you're hosting the project and start chatting!</p></div><style data-emotion-css="1feh9oy">.css-1feh9oy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-top:2em;margin-bottom:2em;}.css-1feh9oy span{font-weight:bold;margin-right:5px;}.css-1feh9oy a{margin-right:10px;}</style><div class="css-1feh9oy"><span>Tags:</span><a href="/tags/php">#<!-- -->php</a><a href="/tags/ratchet">#<!-- -->ratchet</a><a href="/tags/websockets">#<!-- -->websockets</a></div><style data-emotion-css="1gwgz2q">.css-1gwgz2q{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-bottom:1em;}.css-1gwgz2q a + a{margin-left:10px;}</style><div class="css-1gwgz2q"><a href="/blog/react-component-for-svg-icons">« <!-- -->React component for SVG icons</a><a href="/blog/simple-chat-application-using-react-and-socket-io">Simple chat application using React and Socket.io<!-- --> »</a></div></div></main><style data-emotion-css="46b038">.css-46b038{margin-top:30px;}</style><footer class="css-46b038">© <!-- -->2023<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/simple-chat-application-in-php-using-ratchet";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-1ea82b852c7088465fbe.js"],"app":["/app-5eb3d74c66cffa4d5744.js"],"component---src-pages-404-js":["/component---src-pages-404-js-a1a1d500f025aea3be51.js"],"component---src-pages-about-js":["/component---src-pages-about-js-2c243d5865794a61a5a4.js"],"component---src-pages-index-js":["/component---src-pages-index-js-b2f1b0a1f5940ce48f34.js"],"component---src-templates-all-tags-index-js":["/component---src-templates-all-tags-index-js-cc7f003fd5d5e8cb5b61.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f7e80faf665a18051650.js"],"component---src-templates-single-tag-index-js":["/component---src-templates-single-tag-index-js-ce5b8974d24bb230b945.js"]};/*]]>*/</script><script src="/polyfill-1ea82b852c7088465fbe.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-f7e80faf665a18051650.js" async=""></script><script src="/commons-a484f0fa5c3e150fe32e.js" async=""></script><script src="/app-5eb3d74c66cffa4d5744.js" async=""></script><script src="/styles-806f4b82980a743e7980.js" async=""></script><script src="/framework-6271aad6e301858fde44.js" async=""></script><script src="/webpack-runtime-fda9dc8a864f6339dfc4.js" async=""></script></body></html>